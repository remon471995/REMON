<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amadeus Smart Converter</title>
    <style>
        /* --- General Styles --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f6;
            color: #333;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            direction: ltr; /* Default to LTR for English interface */
            text-align: left;
            line-height: 1.6;
        }

        /* --- Login Page Styles --- */
        .login-container {
            max-width: 400px;
            width: 90%;
            background-color: #ffffff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            box-sizing: border-box;
            display: block; /* Initially visible */
        }
        .login-container h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
        }
        .login-form-group {
            margin-bottom: 20px;
        }
        .login-container label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
            font-size: 1.1em;
        }
        .login-container input[type="text"],
        .login-container input[type="password"] {
            width: calc(100% - 22px); /* 100% - padding - border */
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
            background-color: #fcfcfc;
            direction: ltr; /* For input fields to type left-to-right */
            text-align: left;
        }
        .login-container button {
            background-color: #007bff;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            width: 100%;
            display: block;
            margin-top: 30px;
        }
        .login-container button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
        .contact-info {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
            text-align: center;
            color: #666;
            font-size: 0.95em;
            direction: ltr;
        }
        .message {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
            font-weight: bold;
            display: none; /* Hidden by default */
        }
        .message.error {
            background-color: #ffeaea;
            color: #dc3545;
            border: 1px solid #dc3545;
        }
        .message.success {
            background-color: #e6ffe6;
            color: #28a745;
            border: 1px solid #28a745;
        }

        /* --- Converter Tool Styles (Existing Styles, with minor adjustments) --- */
        .converter-container {
            max-width: 900px;
            width: 90%;
            margin: 40px auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            display: none; /* Hidden initially */
            direction: ltr; /* Set to LTR for English conversion tool */
            text-align: left;
        }
        .converter-container h1, .converter-container h2 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .converter-container .form-group {
            margin-bottom: 20px;
        }
        .converter-container label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        .converter-container textarea {
            width: calc(100% - 22px);
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
            background-color: #fcfcfc;
            min-height: 100px;
            resize: vertical;
            direction: ltr; /* Amadeus segments are LTR */
            text-align: left;
        }
        .converter-container .button-group {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .converter-container button {
            background-color: #007bff;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            white-space: nowrap;
        }
        .converter-container button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
        .converter-container button.clear-button {
            background-color: #6c757d;
        }
        .converter-container button.clear-button:hover {
            background-color: #5a6268;
        }
        .converter-container button.copy-button {
            background-color: #28a745;
        }
        .converter-container button.copy-button:hover {
            background-color: #218838;
        }
        .results-section {
            margin-top: 40px;
            border-top: 1px solid #eee;
            padding-top: 30px;
            /* text-align: right; */ /* This was for full RTL block, now adjusting for mixed content */
        }
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-direction: row; /* Keep order for LTR languages like English */
        }
        .results-header h2 {
            margin: 0;
            text-align: left; /* Align heading to the left for English */
        }
        .flight-segment {
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            line-height: 1.8;
            direction: rtl; /* Keep RTL for Arabic content */
            font-size: 16px;
            text-align: right; /* Ensure text aligns right within the segment */
        }
        .flight-segment p {
            margin: 0; /* Remove default paragraph margin */
            padding: 2px 0; /* Add slight padding for spacing */
        }
        .error-message {
            color: #dc3545;
            font-weight: bold;
            text-align: center;
            margin-top: 20px;
            background-color: #ffeaea;
            border: 1px solid #dc3545;
            padding: 10px;
            border-radius: 5px;
        }
        .info-message {
            color: #28a745;
            font-weight: bold;
            text-align: center;
            margin-top: 20px;
        }
        .copy-feedback {
            text-align: center;
            color: #28a745;
            margin-top: 10px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            min-height: 20px;
        }
        .copy-feedback.show {
            opacity: 1;
        }
        code {
            background-color: #eee;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
        }
    </style>
</head>
<body>

    <div id="loginPage" class="login-container">
        <h1>Login</h1>

        <div class="login-form-group">
            <label for="username">Username:</label>
            <input type="text" id="username" name="username" placeholder="Enter username">
        </div>

        <div class="login-form-group">
            <label for="password">Password:</label>
            <input type="password" id="password" name="password" placeholder="Enter password">
        </div>

        <button id="loginButton">Login</button>

        <div id="loginMessage" class="message"></div>

        <div class="contact-info">
            <p>For inquiries, please contact:</p>
            <p><strong>Name:</strong> Remon</p>
            <p><strong>Mobile:</strong> +201222880819</p>
        </div>
    </div>

    <div id="converterToolPage" class="converter-container">
        <h1>AMADEUS Converter</h1>
        <p style="text-align: center; color: #666;">
            Enter one or more Amadeus segments (each segment on a new line).
            <br>
            The converter will now attempt to automatically detect and parse segments.
        </p>

        <div class="form-group">
            <label for="amadeusSegments">Amadeus Segments:</label>
            <textarea id="amadeusSegments" rows="5" placeholder="Example:
1 EY 656 E 30SEP 2*KWIAUH DK1 1610 1850 30SEP E 0 320 R
2 MS 611 T 30SEP 2*CAIADD DK1 2330 0310 01OCT E 0 738 M"></textarea>
        </div>

        <div class="button-group">
            <button id="convertButton">Convert</button>
            <button id="clearInputButton" class="clear-button">Clear Input</button>
        </div>

        <div class="results-section">
            <div class="results-header">
                <h2>Converted Results</h2>
                <div class="button-group" style="margin-top: 0; margin-bottom: 0; gap: 10px;">
                    <button id="copyResultsButton" class="copy-button" style="padding: 8px 15px; font-size: 16px;">Copy</button>
                    <button id="clearResultsButton" class="clear-button" style="padding: 8px 15px; font-size: 16px;">Clear Results</button>
                </div>
            </div>
            <div id="copyFeedback" class="copy-feedback">Copied successfully!</div>
            <div id="resultsOutput">
                <p style="text-align: center; color: #888;">Results will appear here after conversion.</p>
            </div>
        </div>
    </div>

    <script>
        // Get references to both pages
        const loginPage = document.getElementById('loginPage');
        const converterToolPage = document.getElementById('converterToolPage');

        // --- Login Logic ---
        document.getElementById('loginButton').addEventListener('click', function() {
            const usernameInput = document.getElementById('username').value;
            const passwordInput = document.getElementById('password').value;
            const loginMessage = document.getElementById('loginMessage');

            // Hide any previous message
            loginMessage.style.display = 'none';
            loginMessage.classList.remove('error', 'success');
            loginMessage.textContent = '';

            // Required login credentials
            const correctUsername = 'Remon';
            const correctPassword = 'Asd12345@';

            if (usernameInput === correctUsername && passwordInput === correctPassword) {
                loginMessage.classList.add('success');
                loginMessage.textContent = 'Login successful! Redirecting...';
                loginMessage.style.display = 'block';

                // Successfully logged in: Hide login page and show converter tool
                setTimeout(() => {
                    loginPage.style.display = 'none';
                    converterToolPage.style.display = 'block';
                    document.body.style.justifyContent = 'flex-start'; // Adjust body alignment for converter
                    document.body.style.alignItems = 'flex-start';
                    document.body.style.margin = '20px'; // Re-add body margin for the tool page
                }, 1000); // Give a small delay to show success message
            } else {
                loginMessage.classList.add('error');
                loginMessage.textContent = 'Incorrect username or password. Please try again.';
                loginMessage.style.display = 'block';
            }
        });

        // --- Amadeus Converter Tool Logic ---

        // Airline and Airport data (provided lists remain the same, as they are codes/names)
        const airlines = {
            "TK": "الخطوط التركية", "FZ": "فلاي دبي", "SV": "الخطوط السعودية", "MS": "مصر للطيران",
            "QR": "الخطوط القطرية", "EK": "طيران الإمارات", "WY": "الطيران العماني", "RJ": "الملكية الأردنية",
            "EY": "الاتحاد للطيران", "GF": "الخطوط الخليجية", "KU": "الخطوط الكويتية", "ME": "طيران الشرق الأوسط (لبنان)",
            "XY": "ناس للطيران (السعودية)", "G9": "العربية للطيران (الإمارات)", "J9": "طيران الجزيرة (الكويت)",
            "W5": "ماهان إير (إيران)", "IR": "الخطوط الجوية الإيرانية", "IY": "اليمنية", "NP": "النيل للطيران (مصر)",
            "NE": "نسما للطيران (مصر/السعودية)", "SM": "إير كايرو (مصر)", "UJ": "المصرية العالمية للطيران",
            "ET": "الخطوط الجوية الإثيوبية", "TU": "الخطوط التونسية", "AH": "الخطوط الجوية الجزائرية",
            "AT": "الخطوط الملكية المغربية", "B4": "النواقل الوطنية (موريتانيا)", "QY": "الخطوط الجوية السودانية",
            "LH": "لوفتهانزا (ألمانيا)", "BA": "الخطوط البريطانية", "PC": "بيغاسوس التركية", "AZ": "أليطاليا (إيطاليا)",
            "AF": "الخطوط الفرنسية", "KL": "كيه إل إم الهولندية", "IB": "إيبيريا الإسبانية",
            "U2": "إيزي جيت (المملكة المتحدة)", "OS": "الخطوط النمساوية", "SK": "الخطوط الاسكندنافية",
            "SN": "الخطوط البلجيكية", "QS": "سمارت وينغز (التشيك)", "OK": "الخطوط التشيكية",
            "LO": "الخطوط البولندية", "LX": "سويس إنترناشونال إيرلاينز", "TP": "تاب البرتغالية",
            "VY": "فويلينغ (إسبانيا)", "FB": "فلاي بلغاريا", "AY": "الخطوط الجوية الفنلندية",
            "EI": "الخطوط الجوية الأيرلندية", "FI": "أيسلندا إير", "RO": "تاروم (رومانيا)",
            "JU": "الخطوط الجوية الصربية", "OV": "نورديكا (إستونيا)", "BT": "إيربالتيك (لاتفيا)",
            "UX": "إير أوروبا (إسبانيا)", "FR": "ريان إير (أيرلندا)", "W6": "ويز إير (المجر)",
            "BY": "توي إيرويز (المملكة المتحدة)", "LS": "جيت2.كوم (المملكة المتحدة)",
            "HV": "ترانسافيا (هولندا/فرنسا)", "EW": "يورو وينغز (ألمانيا)", "A3": "الخطوط الجوية اليونانية إيجه",
            "OA": "أولمبيك إير (اليونان)", "CY": "سايبرس إيرويز (قبرص)", "KM": "إير مالطا",
            "OU": "كرواتيا إيرلاينز", "JP": "أدريا إيرويز (سلوفينيا - توقفت)", "B2": "بيلافيا (بيلاروسيا)",
            "PS": "الخطوط الجوية الأوكرانية الدولية", "EN": "إير دولوميتي (إيطالية)", "VO": "فولوتيا (إسبانية)",
            "IG": "نيوس (إيطالية)", "XR": "ساس كونكت (الدنمارك/السويد)", "BD": "بلو إير (رومانيا - توقفت لكن معروفة)",
            "X3": "توي فلاي ألمانيا (ألمانيا)", "SU": "إيروفلوت", "S7": "خطوط إس 7 الجوية", "UT": "يوت إير",
            "DP": "بوبيدا (Pobeda Airlines)", "FV": "روسيا الخطوط الجوية", "WZ": "رد وينغز ايرلاينز",
            "AI": "طيران الهند", "SQ": "الخطوط الجوية السنغافورية", "CX": "كاثي باسيفيك (هونغ كونغ)",
            "JL": "الخطوط الجوية اليابانية", "NH": "أول نيبون إيرويز (اليابان)",
            "KE": "الخطوط الجوية الكورية (كوريا الجنوبية)", "BR": "إيفا إير (تايوان)",
            "CA": "الخطوط الجوية الصينية", "MU": "خطوط شرق الصين الجوية", "CZ": "خطوط جنوب الصين الجوية",
            "TG": "الخطوط الجوية التايلاندية", "VN": "الخطوط الجوية الفيتنامية",
            "PK": "الخطوط الجوية الباكستانية الدولية", "UL": "الخطوط الجوية السريلانكية",
            "MH": "الخطوط الجوية الماليزية", "GA": "جارودا إندونيسيا", "PR": "الخطوط الجوية الفلبينية",
            "CI": "تشاينا إيرلاينز (تايوان)", "OZ": "آسيانا إيرلاينز (كوريا الجنوبية)", "TR": "سكوت (سنغافورة)",
            "OD": "ماليندو إير (ماليزيا)", "AK": "طيران آسيا (ماليزيا)", "D7": "طيران آسيا إكس (ماليزيا)",
            "QZ": "إير آسيا إندونيسيا", "ID": "باتيك إير (إندونيسيا)", "JT": "ليون إير (إندونيسيا)",
            "IW": "وينغز إير (إندونيسيا)", "J2": "أذربيجان الخطوط الجوية", "HY": "أوزبكستان إيرويز",
            "KC": "إير أستانا (كازاخستان)", "DV": "سكات إيرلاينز (كازاخستان)", "QP": "طيران مالديفيان",
            "BG": "بيمان بنغلاديش إيرلاينز", "5J": "سيبو باسيفيك (الفلبين)", "ZE": "إيستار جيت (كوريا الجنوبية)",
            "LJ": "جين إير (كوريا الجنوبية)", "7C": "جيجو اير (كوريا الجنوبية)", "GK": "جيت ستار جابان (اليابان)",
            "MM": "بيتش (اليابان)", "HO": "خطوط شنغهاي الجوية (الصين)", "MF": "خطوط شيامن الجوية (الشرق)",
            "8Y": "ميانيغ إير (منغوليا)", "FM": "خطوط شنغهاي الجوية (الصين)",
            "JD": "خطوط بكين كابيتال الجوية (الصين)", "PN": "خطوط ويست إير (الصين)",
            "GX": "خطوط جوانغشي بيبو الخليج الجوية (الصين)", "DR": "خطوط فيتريكس ايرلاينز (إندونيسيا)",
            "QG": "سيتيلينك (إندونيسيا)", "PG": "بانكوك ايرويز (تايلاند)", "VJ": "فييت جيت اير (فيتنام)",
            "AA": "الخطوط الجوية الأمريكية", "DL": "دلتا إيرلاينز (الولايات المتحدة)",
            "UA": "يونايتد إيرلاينز (الولايات المتحدة)", "AC": "الخطوط الجوية الكندية",
            "AS": "خطوط ألاسكا الجوية (الولايات المتحدة)",
            "WN": "ساوث ويست إيرلاينز (الولايات المتحدة)",
            "B6": "جيت بلو إيرويز (الولايات المتحدة)",
            "NK": "سبيريت إيرلاينز (الولايات المتحدة)",
            "F9": "فرونتير إيرلاينز (الولايات المتحدة)",
            "G4": "أليجانت إير (الولايات المتحدة)",
            "SY": "صن كانتري إيرلاينز (الولايات المتحدة)", "TS": "إير ترانسات (كندا)",
            "WS": "وست جيت (كندا)", "PD": "بورتر إيرلاينز (كندا)", "HA": "خطوط هاواي الجوية (الولايات المتحدة)",
            "CM": "كوبا إيرلاينز (بنما)", "YX": "ريجسيونال إكسبريس (الولايات المتحدة)",
            "G7": "غو جيت ايرلاينز (الولايات المتحدة)", "LA": "لاتام إيرلاينز (تشيلي - المجموعة الأم)",
            "AR": "الخطوط الجوية الأرجنتينية", "AV": "أفيانكا (كولومبيا - المجموعة الأم)",
            "AM": "أيرومكسيكو", "H2": "سكاي إيرلاين (تشيلي)", "JJ": "لاتام برازيل (البرازيل)",
            "TA": "أفيانكا السلفادور", "PZ": "لاتام باراغواي", "LP": "لاتام بيرو",
            "QF": "كانتاس (أستراليا)", "NZ": "طيران نيوزيلندا", "VA": "فيرجن أستراليا",
            "FJ": "فيجي إيرويز", "PX": "إير نيوغيني (بابوا غينيا الجديدة)", "SB": "إير كاليدوني (كاليدونيا الجديدة)",
            "SA": "الخطوط الجوية لجنوب أفريقيا", "KQ": "الخطوط الكينية", "HM": "طيران سيشل",
            "MK": "طيران موريشيوس", "WB": "رواند إير (رواندا)", "DT": "تاغ أنغولا (أنجولا)",
            "TM": "الخطوط الجوية الموزمبيقية", "QZ": "جنوب أفريقيا إكسبرس (جنوب أفريقيا - توقفت لكن معروفة)",
            "VN": "خطوط جنوب أفريقيا إكسبرس (جنوب أفريقيا - توقفت)", "W3": "أزول لينهاس آيرياس (برازيلية - لكن رموز IATA قد تكون مضللة)",
            "FX": "فيديكس إكسبرس", "UPS": "يو بي إس ايرلاينز", "PO": "بوينغ ايرلاينز"
        };

        const airports = {
            "DXB": "دبي الدولي (الإمارات)", "KWI": "الكويت الدولي (الكويت)", "JED": "جدة الملك عبد العزيز الدولي (السعودية)",
            "DOH": "الدوحة حمد الدولي (قطر)", "RUH": "الرياض الملك خالد الدولي (السعودية)", "AUH": "أبو ظبي الدولي (الإمارات)",
            "BAH": "البحرين الدولي (البحرين)", "MCT": "مسقط الدولي (عمان)", "SHJ": "الشارقة الدولي (الإمارات)",
            "DMM": "الدمام الملك فهد الدولي (السعودية)", "MED": "المدينة المنورة الأمير محمد بن عبد العزيز الدولي (السعودية)",
            "ELQ": "القصيم الأمير نايف بن عبد العزيز الدولي (السعودية)", "HAS": "حائل الدولي (السعودية)",
            "TUU": "طريف المحلي (السعودية)", "RAH": "رفحاء المحلي (السعودية)", "AQI": "القيصومة المحلي (السعودية)",
            "HOF": "الهفوف المحلي (السعودية)", "TIF": "الطائف الإقليمي (السعودية)", "ABH": "أبها الدولي (السعودية)",
            "GIZ": "جازان الملك عبد الله الإقليمي (السعودية)", "AHB": "أبها الإقليمي (السعودية)",
            "BHH": "بيشة المحلي (السعودية)", "DWD": "الدوادمي المحلي (السعودية)", "EJH": "الوجه المحلي (السعودية)",
            "KMC": "خميس مشيط المحلي (السعودية)", "RAE": "عرعر المحلي (السعودية)", "WAE": "وادي الدواسر المحلي (السعودية)",
            "ULH": "العلا المحلي (السعودية)", "YNB": "ينبع الإقليمي (السعودية)", "XXN": "نجران المحلي (السعودية)",
            "DWC": "دبي وورلد سنترال (آل مكتوم الدولي) (الإمارات)", "FJR": "الفجيرة الدولي (الإمارات)",
            "RKT": "رأس الخيمة الدولي (الإمارات)", "KHS": "خصب (عمان)", "SOH": "صحار (عمان)", "DQM": "الدقم (عمان)",
            "CAI": "القاهرة الدولي (مصر)", "LXR": "الأقصر الدولي (مصر)", "SSH": "شرم الشيخ الدولي (مصر)",
            "HRG": "الغردقة الدولي (مصر)", "ATZ": "أسيوط (مصر)", "HBE": "برج العرب (الإسكندرية، مصر)",
            "ALY": "النزهة (الإسكندرية، مصر)", "ASW": "أسوان الدولي (مصر)", "RMF": "مرسى علم الدولي (مصر)",
            "MUH": "مرسى مطروح الدولي (مصر)", "HMB": "سوهاج الدولي (مصر)", "TCP": "طابا الدولي (مصر)",
            "AMM": "الملكة علياء الدولي (عمان، الأردن)", "BEY": "رفيق الحريري الدولي (بيروت، لبنان)",
            "DAM": "دمشق الدولي (سوريا)", "BGW": "بغداد الدولي (العراق)", "ERB": "أربيل الدولي (العراق)",
            "IST": "إسطنبول (مطار إسطنبول الجديد، تركيا)", "SAW": "إسطنبول صبيحة كوكجن (تركيا)",
            "AYT": "أنطاليا (تركيا)", "ESB": "أنقرة إسنبوغا الدولي (تركيا)", "ADB": "إزمير عدنان مندريس (تركيا)",
            "IKA": "الإمام الخميني الدولي (طهران، إيران)", "THR": "مطار مهرآباد الدولي (طهران، إيران)",
            "MHD": "مشهد الدولي (إيران)", "SYZ": "شيراز الدولي (إيران)", "TUN": "تونس قرطاج الدولي (تونس)",
            "ALG": "الجزائر هواري بومدين الدولي (الجزائر)", "CMN": "الدار البيضاء محمد الخامس الدولي (المغرب)",
            "AGP": "أكادير المسيرة الدولي (المغرب)", "FEZ": "فاس سايس الدولي (المغرب)", "RAK": "مراكش المنارة الدولي (المغرب)",
            "KRT": "الخرطوم الدولي (السودان)", "HGA": "هرجيسا إيجال الدولي (صوماليلاند - الصومال)",
            "MGQ": "مقديشو آدم عدي الدولي (الصومال)", "LHR": "لندن هيثرو (المملكة المتحدة)",
            "LGW": "لندن جاتويك (المملكة المتحدة)", "STN": "لندن ستانستيد (المملكة المتحدة)",
            "MAN": "مانشستر (المملكة المتحدة)", "EDI": "إدنبرة (المملكة المتحدة)", "DUB": "دبلن (أيرلندا)",
            "CDG": "باريس شارل ديغول (فرنسا)", "ORY": "باريس أورلي (فرنسا)", "FRA": "فرانكفورت (ألمانيا)",
            "MUC": "ميونخ (ألمانيا)", "BER": "برلين براندنبورغ (ألمانيا)", "DUS": "دوسلدورف (ألمانيا)",
            "HAM": "هامبورغ (ألمانيا)", "STR": "شتوتغارت (ألمانيا)", "ZRH": "زيوريخ (سويسرا)",
            "GVA": "جنيف (سويسرا)", "VIE": "فيينا (النمسا)", "AMS": "أمستردام سخيبول (هولندا)",
            "BRU": "بروكسل (بلجيكا)", "CPH": "كوبنهاغن (الدنمارك)", "OSL": "أوسلو غارديرموين (النرويج)",
            "ARN": "ستوكهولم أرلاندا (السويد)", "HEL": "هلسنكي فانتا (فنلندا)", "FCO": "روما فيوميتشينو (إيطاليا)",
            "MXP": "ميلانو مالبينسا (إيطاليا)", "BCN": "برشلونة إل برات (إسبانيا)",
            "MAD": "مدريد باراخاس أدولفو سواريز (إسبانيا)", "LIS": "لشبونة هومبرتو دلغادو (البرتغال)",
            "PRG": "براغ فاكلاف هافيل (التشيك)", "WAW": "وارسو شوبان (بولندا)",
            "BUD": "بودابست فيرينك ليزت الدولي (المجر)", "ATH": "أثينا الدولي (اليونان)",
            "SKG": "سالونيك مقدونيا (اليونان)", "SOF": "صوفيا (بلغاريا)",
            "OTP": "بوخارست هنري كواندا الدولي (رومانيا)", "BEG": "بلغراد نيكولا تيسلا (صربيا)",
            "ZAG": "زغرب (كرواتيا)", "LJU": "ليوبليانا يوجي بوتشنيك (سلوفينيا)", "TIA": "تيرانا الأم تيريزا (ألبانيا)",
            "SKP": "سكوبيه الدولي (مقدونيا الشمالية)", "SJJ": "سراييفو الدولي (البوسنة والهرسك)",
            "FLR": "فلورنسا (إيطاليا)", "VCE": "فينيسيا ماركو بولو (إيطاليا)", "NAP": "نابولي (إيطاليا)",
            "CTA": "كاتانيا (إيطاليا)", "PMO": "باليرمو (إيطاليا)", "BGY": "بيرغامو أوريو آل سيريو (إيطاليا)",
            "CRL": "شارلروة بروكسل جنوب (بلجيكا)", "PMI": "بالما دي مايوركا (إسبانيا)",
            "ALC": "أليكانتي (إسبانيا)", "VLC": "فالنسيا (إسبانيا)", "FAO": "فارو (البرتغال)",
            "OPO": "بورتو (البرتغال)", "KRK": "كراكوف (بولندا)", "GDN": "غدانسك ليخ فاليسا (بولندا)",
            "KTW": "كاتوفيتشي (بولندا)", "TXL": "برلين تيجيل (مغلق حالياً)", "SXF": "برلين شونفيلد (مغلق حالياً)",
            "VNO": "فيلنيوس (ليتوانيا)", "RIX": "ريغا (لاتفيا)", "TLL": "تالين (إستونيا)",
            "KGD": "كالينينغراد خربوفو (روسيا)", "PUY": "بولا (كرواتيا)", "SVO": "موسكو شيريميتيفو (روسيا)",
            "DME": "موسكو دوموديدوفو (روسيا)", "VKO": "موسكو فنوكوفو (روسيا)", "LED": "سانت بطرسبرغ بولكوفو (روسيا)",
            "KZN": "قازان الدولي (روسيا)", "AER": "سوتشي الدولي (روسيا)", "SVX": "يكاترينبورغ كولتسوفو (روسيا)",
            "OVB": "نوفوسيبيرسك تولماتشيفو (روسيا)", "ROV": "روستوف نا دونو بلاطوف (روسيا)",
            "ABA": "أباكان (روسيا)", "AAQ": "أنابا (روسيا)",
            "KUL": "كوالالمبور الدولي (ماليزيا)", "BKK": "بانكوك سوفارنابومي (تايلاند)",
            "DMK": "بانكوك دون موينغ (تايلاند)", "ICN": "سيؤول إنشيون (كوريا الجنوبية)",
            "NRT": "طوكيو ناريتا (اليابان)", "HND": "طوكيو هانيدا (اليابان)", "HKG": "هونغ كونغ الدولي",
            "PEK": "بكين كابيتال الدولي (الصين)", "PVG": "شنغهاي بودونغ الدولي (الصين)",
            "CAN": "قوانغتشو باييون الدولي (الصين)", "SHA": "شنغهاي هونغكياو الدولي (الصين)",
            "CTU": "تشنغدو شوانغليو الدولي (الصين)", "XIY": "شيان شيانيانغ الدولي (الشرق)",
            "SZX": "شنتشن باوآن الدولي (الصين)", "CRK": "كلارك الدولي (الفلبين)",
            "CEB": "ماكتان سيبو الدولي (الفلبين)", "MNL": "مانيلا نينوي أكينو الدولي (الفلبين)",
            "DAD": "دا نانغ الدولي (فيتنام)", "HAN": "هانوي نوي باي الدولي (فيتنام)",
            "SGN": "مدينة هو تشي منه تان سون نهات الدولي (فيتنام)", "REP": "سيم ريب الدولي (كمبوديا)",
            "PQC": "فو كوك الدولي (فيتنام)", "CNX": "تشيانغ ماي الدولي (تايلاند)",
            "HKT": "بوكيت الدولي (تايلاند)", "KTM": "كاتماندو تريبوفان الدولي (نيبال)",
            "DAC": "دكا شاه جلال الدولي (بنغلاديش)", "ISB": "إسلام أباد الدولي (باكستان)",
            "LHE": "لاهور علامة إقبال الدولي (باكستان)", "KHI": "كراتشي جناح الدولي (باكستان)",
            "MLE": "ماليه فيلانا الدولي (المالديف)", "GAN": "غان الدولي (المالديف)",
            "GYD": "باكو حيدر علييف الدولي (أذربيجان)", "TSE": "أستانا الدولي (كازاخستان)",
            "TAS": "طشقند الدولي (أوزبكستان)", "CGK": "جاكرتا سوكارنو هاتا الدولي (إندونيسيا)",
            "DPS": "دينباسار نغوراه راي (بالي، إندونيسيا)", "SUB": "سورابايا جواندا (إندونيسيا)",
            "PEN": "بينانغ الدولي (ماليزيا)", "BKI": "كوتا كينابالو (ماليزيا)",
            "CMB": "كولومبو باندرانايكي (سريلانكا)", "GOI": "غوا دابوليم (الهند)",
            "BLR": "بنغالور كيمبيغودا (الهند)", "MAA": "تشيناي (الهند)", "HYD": "حيدر أباد راجيف غاندي (الهند)",
            "CCU": "كولكاتا نيتاجي سوبهاس تشاندرا بوس (الهند)", "DEL": "نيودلهي إنديرا غاندي (الهند)",
            "BOM": "مومباي تشاتراباتي شيفاجي (الهند)", "IXM": "مادوراي (الهند)",
            "CJB": "كويمباتور (الهند)", "UPG": "ماكاسار سلطان حسن الدين (إندونيسيا)",
            "KNO": "ميدان كوالانامو (إندونيسيا)", "JOG": "يوجياكارتا الدولي (إندونيسيا)",
            "SRG": "سمارانغ أحمد ياني الدولي (إندونيسيا)", "KIX": "أوساكا كانساي الدولي (اليابان)",
            "FUK": "فوكوكا (اليابان)", "CTS": "سابورو تشيتوس الجديدة (اليابان)", "HKD": "هاكوداته (اليابان)",
            "JFK": "نيويورك جون إف كينيدي (الولايات المتحدة)", "LAX": "لوس أنجلوس (الولايات المتحدة)",
            "ORD": "شيكاغو أوهير (الولايات المتحدة)", "YYZ": "تورونتو بيرسون (كندا)",
            "YVR": "فانكوفر (كندا)", "MEX": "مكسيكو سيتي (المكسيك)", "MIA": "ميامي الدولي (الولايات المتحدة)",
            "ATL": "أتلانتا هارتسفيلd جاكسون (الولايات المتحدة)", "DEN": "دنفر الدولي (الولايات المتحدة)",
            "DFW": "دالاس فورت وورث الدولي (الولايات المتحدة)", "SEA": "سياتل تاكوما الدولي (الولايات المتحدة)",
            "BOS": "بوسطن لوغان الدولي (الولايات المتحدة)", "MCO": "أورلاندو الدولي (الولايات المتحدة)",
            "LAS": "لاس فيغاس هاري ريد الدولي (الولايات المتحدة)", "SFO": "سان فرانسيسكو الدولي (الولايات المتحدة)",
            "CLT": "شارلوت دوغلاس الدولي (الولايات المتحدة)", "PHX": "فينيكس سكاي هاربر الدولي (الولايات المتحدة)",
            "PDX": "بورتلاند الدولي (الولايات المتحدة)", "SLC": "سولت ليك سيتي الدولي (الولايات المتحدة)",
            "MSP": "منيابوليس سانت بول الدولي (الولايات المتحدة)", "DTW": "ديترويت متروبوليتان (الولايات المتحدة)",
            "IAH": "هيوستن جورج بوش بينكونتيننتال (الولايات المتحدة)", "PTY": "بنما سيتي توكومن الدولي (بنما)",
            "CUN": "كانكون الدولي (المكسيك)", "GRU": "ساو باولو غوارولوس (البرازيل)",
            "EZE": "بوينس آيرس إيزيزا (الأرجنتين)", "SCL": "سانتياغو أرتورو ميرينو بينيتيز (تشيلي)",
            "BOG": "بوغوتا إل دورادو الدولي (كولومبيا)", "LIM": "ليما خورخي شافيز الدولي (بيرو)",
            "PUJ": "بونتا كانا (جمهورية الدومينيكان)", "UIO": "كيتو ماريسكال سوكر الدولي (الإكوادور)",
            "GIG": "ريو دي جانيرو غاليغو الدولي (البرازيل)", "SYD": "سيدني كينغسفورد سميث (أستراليا)",
            "MEL": "ملبورن (أستراليا)", "AKL": "أوكلاند (نيوزيلندا)", "BNE": "بريسبان (أستراليا)",
            "PER": "بيرث (أستراليا)", "ADL": "أديلايد (أستراليا)", "CHC": "كرايستشيرش (نيوزيلندا)",
            "WLG": "ويلينغتون (نيوزيلندا)", "PPT": "بابيتي فآ الدولي (بولينيزيا الفرنسية)",
            "NAN": "نادي الدولي (فيجي)", "APW": "أبيا فاليولو الدولي (ساموا)",
            "POM": "بورت مورسبي جاكسون الدولي (بابوا غينيا الجديدة)",
            "ADD": "أديس أبابا بول الدولي (إثيوبيا)", // <--- هذا هو الإضافة الجديدة
            "SA": "الخطوط الجوية لجنوب أفريقيا", "KQ": "الخطوط الكينية", "HM": "طيران سيشل",
            "MK": "طيران موريشيوس", "WB": "رواند إير (رواندا)", "DT": "تاغ أنغولا (أنجولا)",
            "TM": "الخطوط الجوية الموزمبيقية", "QZ": "جنوب أفريقيا إكسبرس (جنوب أفريقيا - توقفت لكن معروفة)",
            "VN": "خطوط جنوب أفريقيا إكسبرس (جنوب أفريقيا - توقفت)", "W3": "أزول لينهاس آيرياس (برازيلية - لكن رموز IATA قد تكون مضللة)",
            "FX": "فيديكس إكسبرس", "UPS": "يو بي إس ايرلاينز", "PO": "بوينغ ايرلاينز"
        };

        // Function to convert 24-hour time to 12-hour format with AM/PM
        function formatTime12Hour(time24) {
            if (!time24 || time24.length !== 4) return 'غير محدد';
            let hours = parseInt(time24.substring(0, 2), 10);
            const minutes = time24.substring(2, 4);
            const ampm = hours >= 12 ? 'مساءً' : 'صباحًا';
            hours = hours % 12;
            hours = hours ? hours : 12; // The hour '00' should be '12'
            return `${hours.toString().padStart(2, '0')}:${minutes} ${ampm}`;
        }

        // Function to get day name from a date object
        function getDayName(date) {
            const days = ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
            return days[date.getDay()];
        }

        // Function to get month name from month code
        function getMonthName(monthCode) {
            const months = {
                'JAN': 'يناير', 'FEB': 'فبراير', 'MAR': 'مارس', 'APR': 'أبريل',
                'MAY': 'مايو', 'JUN': 'يونيو', 'JUL': 'يوليو', 'AUG': 'أغسطس',
                'SEP': 'سبتمبر', 'OCT': 'أكتوبر', 'NOV': 'نوفمبر', 'DEC': 'ديسمبر'
            };
            return months[monthCode.toUpperCase()] || 'غير معروف';
        }

        // Helper to get month number from month code (0-11)
        function getMonthNumber(monthCode) {
            const monthMap = {
                'JAN': 0, 'FEB': 1, 'MAR': 2, 'APR': 3, 'MAY': 4, 'JUN': 5,
                'JUL': 6, 'AUG': 7, 'SEP': 8, 'OCT': 9, 'NOV': 10, 'DEC': 11
            };
            return monthMap[monthCode.toUpperCase()];
        }

        // Helper to get month code from month number (0-11)
        function getMonthCode(monthNumber) {
            const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
            return months[monthNumber];
        }

        // Main function to parse a single segment with more flexibility
        function parseAmadeusSegment(segmentString) {
            console.log("Parsing segment:", segmentString); // Log the raw segment
            const result = { rawSegment: segmentString };
            // Split the segment string by any sequence of whitespace
            const parts = segmentString.trim().split(/\s+/); 
            console.log("Segment parts:", parts); // Log parts array
            
            if (parts.length < 5) { 
                result.error = "Invalid segment format. Not enough data to parse. Check if the segment is complete.";
                console.error("Parse Error: " + result.error);
                return result;
            }

            let airlineCode = null;
            let flightNumber = null;
            let departureDatePart = null;
            let routePart = null; 
            let departureTime = null;
            let arrivalTime = null;
            let arrivalDatePart = null; 

            // Step 1: Extract basic info - Segment Number, Airline Code, Flight Number, Booking Class
            
result.segmentNumber = parts[0];

let startIndex = 0;

// Detect if airline code and flight number are merged (like QR1077)
if (/^[A-Z]{2}\d{3,4}$/i.test(parts[1])) {
    airlineCode = parts[1].substring(0, 2);
    flightNumber = parts[1].substring(2);
    result.bookingClass = parts[2];
    startIndex = 3;
} else {
    airlineCode = parts[1];
    flightNumber = parts[2];
    result.bookingClass = parts[3];
    startIndex = 4;
}
 

            console.log("Initial extraction - Airline:", airlineCode, "Flight#:", flightNumber, "Booking Class:", result.bookingClass);


            // Step 2: Find the departure date (DDMMM)
            for (let i = 0; i < parts.length; i++) {
                if (/\d{2}[A-Z]{3}/i.test(parts[i])) { 
                    departureDatePart = parts[i].toUpperCase();
                    console.log("Found departureDatePart:", departureDatePart);
                    break; 
                }
            }

            if (!departureDatePart) {
                result.error = "Could not find a valid departure date (e.g., '30SEP').";
                console.error("Parse Error: " + result.error);
                return result;
            }

            // Step 3: Find the route (AAABBB) and times (HHHH)
            let foundTimes = [];
            for (let i = 0; i < parts.length; i++) {
                const part = parts[i];
                // *** IMPROVED REGEX FOR ROUTE PART (AGAIN, SLIGHT ADJUSTMENT) ***
                // This regex will capture the 6-letter code after optional numbers and star
                const routeMatch = part.match(/^(?:[0-9]+\*)?([A-Z]{6})$/i);
                if (!routePart && routeMatch) { 
                    routePart = routeMatch[1].toUpperCase();
                    console.log("Found routePart:", routePart);
                }

                // Search for 4-digit times
                if (/\b\d{4}\b/.test(part)) { 
                    foundTimes.push(part);
                }
            }
            console.log("Found times array:", foundTimes);

            // Assign departure and arrival times from foundTimes
            if (foundTimes.length >= 2) {
                departureTime = foundTimes[0];
                arrivalTime = foundTimes[1];
            }
            console.log("Departure Time:", departureTime, "Arrival Time:", arrivalTime);


            // Step 4: Find explicit arrival date if it exists (e.g., after times, like '01OCT')
            for (let i = parts.length - 1; i >= 0; i--) {
                const currentPart = parts[i].toUpperCase();
                // Ensure it's a date format and not the same as departure date
                if (/\d{2}[A-Z]{3}/.test(currentPart) && currentPart !== departureDatePart) {
                    // Check if this date appears *after* the times we found
                    let lastTimeIndex = -1;
                    if(foundTimes.length > 0) {
                        // Find the index of the last found time in the original parts array
                        lastTimeIndex = parts.lastIndexOf(foundTimes[foundTimes.length - 1]);
                    }
                    
                    if (lastTimeIndex !== -1 && i > lastTimeIndex) {
                        arrivalDatePart = currentPart;
                        console.log("Found explicit arrivalDatePart:", arrivalDatePart);
                        break;
                    }
                }
            }


            // Final validation of extracted critical components
            if (!airlineCode || !flightNumber || !departureDatePart || !routePart || !departureTime || !arrivalTime) {
                result.error = "Could not identify all critical flight components. Missing: " +
                              (!airlineCode ? "Airline Code, " : "") +
                              (!flightNumber ? "Flight Number, " : "") +
                              (!departureDatePart ? "Departure Date, " : "") +
                              (!routePart ? "Route (Origin/Destination), " : "") +
                              (!departureTime ? "Departure Time, " : "") +
                              (!arrivalTime ? "Arrival Time" : "");
                result.error = result.error.replace(/, $/, ''); // Remove trailing comma and space
                console.error("Parse Error: " + result.error);
                return result;
            }

            // Assign extracted values
            result.airlineCode = airlineCode;
            result.flightNumber = flightNumber;
            result.bookingClass = result.bookingClass; 

            const depDateDay = parseInt(departureDatePart.substring(0, 2), 10);
            const depDateMonthCode = departureDatePart.substring(2, 5).toUpperCase();
            result.day = depDateDay;
            result.month = depDateMonthCode;

            // Infer year based on current date
            const now = new Date();
            const currentYear = now.getFullYear();
            const parsedMonthNumber = getMonthNumber(result.month);

            let departureYear = currentYear;
            let tempDepartureDateForYearCheck = new Date(currentYear, parsedMonthNumber, result.day);
            tempDepartureDateForYearCheck.setHours(12, 0, 0, 0); 
            now.setHours(12, 0, 0, 0); 

            // If the parsed date (in current year) is in the past, assume next year
            if (tempDepartureDateForYearCheck < now) {
                departureYear = currentYear + 1;
            }
            result.year = departureYear;
            console.log("Departure Year determined as:", result.year);

            result.origin = routePart.substring(0, 3);
            result.destination = routePart.substring(3, 6);
            result.departureTime = departureTime;
            result.arrivalTime = arrivalTime;

            // Determine arrival date
            let arrivalDay = result.day;
            let arrivalMonthCode = result.month; // Initialize with departure month code
            let arrivalYear = result.year;

            if (arrivalDatePart) {
                const arrDateDay = parseInt(arrivalDatePart.substring(0, 2), 10);
                const arrDateMonthCode = arrivalDatePart.substring(2, 5).toUpperCase();
                
                arrivalDay = arrDateDay;
                arrivalMonthCode = arrDateMonthCode;

                // Calculate arrival year based on departure date and explicit arrival date
                const depDateObjForCalc = new Date(result.year, getMonthNumber(result.month), result.day, parseInt(result.departureTime.substring(0,2)), parseInt(result.departureTime.substring(2,4)));
                let explicitArrivalDateForCalc = new Date(result.year, getMonthNumber(arrivalMonthCode), arrivalDay, parseInt(result.arrivalTime.substring(0,2)), parseInt(result.arrivalTime.substring(2,4)));
                
                // If explicit arrival date (day/month) is chronologically *before* the departure date (considering year of departure), it's next year
                // This accounts for year rollover (e.g., Dec to Jan) or if the day/month of arrival is simply earlier than departure
                if (explicitArrivalDateForCalc.getTime() < depDateObjForCalc.getTime()) {
                    arrivalYear = result.year + 1;
                } else {
                    arrivalYear = result.year;
                }
                console.log("Explicit Arrival Date Found. Arr Year:", arrivalYear);

            } else {
                // If no explicit arrival date, assume same day unless arrival time implies next day
                const depHours = parseInt(result.departureTime.substring(0,2), 10);
                const arrHours = parseInt(result.arrivalTime.substring(0,2), 10);
                const depMinutes = parseInt(result.departureTime.substring(2,4), 10);
                const arrMinutes = parseInt(result.arrivalTime.substring(2,4), 10);

                // *** التعديل الذي تم هنا ***
                // تم تغيير 'departureMonthCode' إلى 'result.month'
                const departureDateTime = new Date(departureYear, getMonthNumber(result.month), depDateDay, depHours, depMinutes);
                let arrivalDateTime = new Date(departureYear, getMonthNumber(result.month), depDateDay, arrHours, arrMinutes);

                // If arrival time is earlier than departure time on the same calendar day, it implies next day
                if (arrivalDateTime < departureDateTime) {
                    arrivalDateTime.setDate(arrivalDateTime.getDate() + 1); // Increment day by 1
                    arrivalDay = arrivalDateTime.getDate();
                    arrivalMonthCode = getMonthCode(arrivalDateTime.getMonth());
                    arrivalYear = arrivalDateTime.getFullYear();
                    console.log("Arrival inferred as next day. Arr Date:", arrivalDay, arrivalMonthCode, arrivalYear);
                }
            }

            result.arrivalDay = arrivalDay;
            result.arrivalMonth = arrivalMonthCode;
            result.arrivalYear = arrivalYear;


            // Extract airline and airport names
            result.airlineName = airlines[result.airlineCode.toUpperCase()] || result.airlineCode;
            result.originName = airports[result.origin.toUpperCase()] || result.origin;
            result.destinationName = airports[result.destination.toUpperCase()] || result.destination;

            // Format dates and times
            const departureDateObj = new Date(result.year, getMonthNumber(result.month), result.day);
            const arrivalDateObj = new Date(result.arrivalYear, getMonthNumber(result.arrivalMonth), result.arrivalDay);


            result.formattedDepartureTime = formatTime12Hour(result.departureTime);
            result.formattedArrivalTime = formatTime12Hour(result.arrivalTime);

            // Ensure formatted date includes day name and year consistently
            result.formattedDepartureDate = `${getDayName(departureDateObj)} ${result.day} ${getMonthName(result.month)} ${result.year}`;
            result.formattedArrivalDate = `${getDayName(arrivalDateObj)} ${result.arrivalDay} ${getMonthName(result.arrivalMonth)} ${result.arrivalYear}`;

            console.log("Successfully parsed:", result);
            return result;
        }


        document.getElementById('convertButton').addEventListener('click', function() {
            console.log("Convert button clicked!");
            const amadeusSegmentsInput = document.getElementById('amadeusSegments').value;
            const resultsOutput = document.getElementById('resultsOutput');
            const segments = amadeusSegmentsInput.trim().split('\n').filter(s => s.trim() !== '');

            resultsOutput.innerHTML = ''; // Clear previous results

            console.log("Input segments:", segments);

            if (segments.length === 0) {
                resultsOutput.innerHTML = '<p class="info-message">Please enter Amadeus segments to convert.</p>';
                console.log("No segments entered.");
                return;
            }

            let allSegmentsData = [];
            let hasError = false;

            segments.forEach(segmentString => {
                const parsed = parseAmadeusSegment(segmentString);
                allSegmentsData.push(parsed);
                if (parsed.error) {
                    hasError = true;
                    resultsOutput.innerHTML += `<div class="error-message">Error parsing segment: <code>${segmentString}</code><br>${parsed.error}</div>`;
                    console.error("Error encountered for segment:", segmentString, parsed.error);
                }
            });

            if (hasError) {
                console.log("Errors present, stopping rendering of successful segments.");
                return; // If there are errors, display them and stop.
            }

            // Generate HTML for each segment based on the new desired format
            if (allSegmentsData.length > 0) {
                resultsOutput.innerHTML = ''; // Clear "Results will appear here" message if any segment is parsed successfully
            }
            
            allSegmentsData.forEach((data, index) => {
                // Only render if there was no error for this specific segment
                if (!data.error) {
                    let segmentHtml = `<div class="flight-segment">`;
                    segmentHtml += `<p>✈️شركة الطيران:&nbsp;${data.airlineName}</p>`;
                    segmentHtml += `<p>من ${data.originName} (${data.origin}) - إلى ${data.destinationName} (${data.destination})</p>`;
                    segmentHtml += `<p>المغادرة: ✈️ ${data.formattedDepartureTime} ⏰، 📅 ${data.formattedDepartureDate}</p>`;
                    segmentHtml += `<p>الوصول: 🛬 ${data.formattedArrivalTime} ⏰، 📅 ${data.formattedArrivalDate}</p>`;
                    segmentHtml += `</div>`;
                    resultsOutput.innerHTML += segmentHtml;

                    if (index < allSegmentsData.length - 1) {
                        resultsOutput.innerHTML += '<hr style="border-top: 1px dashed #ccc; margin: 25px 0;">'; 
                    }
                    console.log("Segment successfully rendered:", data.rawSegment);
                }
            });

            if (resultsOutput.innerHTML === '') {
                 resultsOutput.innerHTML = '<p class="info-message">No valid segments were parsed successfully.</p>';
                 console.log("No valid segments were parsed successfully, showing info message.");
            }
        });

        document.getElementById('clearInputButton').addEventListener('click', function() {
            document.getElementById('amadeusSegments').value = '';
            console.log("Input cleared.");
        });

        document.getElementById('clearResultsButton').addEventListener('click', function() {
            document.getElementById('resultsOutput').innerHTML = '<p style="text-align: center; color: #888;">Results will appear here after conversion.</p>';
            document.getElementById('copyFeedback').classList.remove('show');
            console.log("Results cleared.");
        });

        document.getElementById('copyResultsButton').addEventListener('click', function() {
            const resultsText = document.getElementById('resultsOutput').innerText;
            navigator.clipboard.writeText(resultsText).then(() => {
                const copyFeedback = document.getElementById('copyFeedback');
                copyFeedback.classList.add('show');
                setTimeout(() => {
                    copyFeedback.classList.remove('show');
                }, 2000);
                console.log("Results copied successfully.");
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                alert('Failed to copy results. Please copy manually.');
            });
        });
    </script>
</body>
</html>

